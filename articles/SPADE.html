<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="gdverse">
<title>Spatial Association Detector(SPADE) • gdverse</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spatial Association Detector(SPADE)">
<meta property="og:description" content="gdverse">
<meta property="og:image" content="https://spatlyu.github.io/gdverse/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gdverse</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/OPGD.html">Optimal Parameters Geographical Detector(OPGD)</a>
    <a class="dropdown-item" href="../articles/RGD.html">Robust Geographical Detector(RGD)</a>
    <a class="dropdown-item" href="../articles/SPADE.html">Spatial Association Detector(SPADE)</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/SpatLyu/gdverse/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Spatial Association Detector(SPADE)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/SpatLyu/gdverse/blob/HEAD/vignettes/SPADE.Rmd" class="external-link"><code>vignettes/SPADE.Rmd</code></a></small>
      <div class="d-none name"><code>SPADE.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="load-data-and-package">Load data and package<a class="anchor" aria-label="anchor" href="#load-data-and-package"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://spatlyu.github.io/gdverse/">gdverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">usfi</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/USFI_Xian.gpkg'</span>,package <span class="op">=</span> <span class="st">'gdverse'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">usfi</span></span>
<span><span class="co">## Simple feature collection with 1037 features and 19 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 295713 ymin: 3784916 xmax: 324202.2 ymax: 3804669</span></span>
<span><span class="co">## Projected CRS: WGS 84 / UTM zone 49N</span></span>
<span><span class="co">## # A tibble: 1,037 × 20</span></span>
<span><span class="co">##      LPI   LSI   GAR    DAR      WAR   TER  NDVI   NDWI   DTH   DTP    DTR   DTW    BH    BD</span></span>
<span><span class="co">##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">##  1  57.2 10.5  0.630 0.273  0.00219  0.979 0.497 -0.356  5.66 1.08  0.934   1.16 3.16  0.635</span></span>
<span><span class="co">##  2  85.7  2.35 0.905 0.0952 0        0.977 0.514 -0.288  5.66 1.41  0.0807  1.57 0.310 0.139</span></span>
<span><span class="co">##  3  41.2  7.85 0.436 0.449  0.000672 0.972 0.365 -0.296  4.38 1.88  0.516   2.37 3.99  0.671</span></span>
<span><span class="co">##  4  39.1  5.40 0.534 0.377  0        0.966 0.395 -0.299  4.25 1.97  0.442   2.81 4.63  0.634</span></span>
<span><span class="co">##  5  32.0  8.04 0.405 0.437  0        0.968 0.354 -0.302  3.65 1.34  0.615   2.55 4.07  0.642</span></span>
<span><span class="co">##  6  58.3  7.91 0.332 0.615  0.000377 0.966 0.312 -0.271  3.69 0.700 0.592   2.25 7.91  0.777</span></span>
<span><span class="co">##  7  98.4  3.34 0.984 0.0161 0        0.948 0.451 -0.248  5.39 1.36  0.124   3.64 0.216 0.111</span></span>
<span><span class="co">##  8  44.6 17.6  0.416 0.502  0.000672 0.949 0.365 -0.295  5.11 1.20  0.926   2.50 6.49  0.747</span></span>
<span><span class="co">##  9  35.9  9.81 0.464 0.467  0.00134  0.936 0.379 -0.309  7.10 2.01  1.03    2.75 5.49  0.692</span></span>
<span><span class="co">## 10  44.3  9.49 0.403 0.504  0.000547 0.926 0.310 -0.278  8.51 2.68  0.658   3.20 3.27  0.601</span></span>
<span><span class="co">## # ℹ 1,027 more rows</span></span>
<span><span class="co">## # ℹ 6 more variables: RL &lt;dbl&gt;, RFD &lt;dbl&gt;, SVF &lt;dbl&gt;, FAR &lt;dbl&gt;, SUHI &lt;dbl&gt;,</span></span>
<span><span class="co">## #   geom &lt;POLYGON [m]&gt;</span></span></code></pre></div>
<p>The polygon spatial data are the streets divided based on roads
within <em>the Ring expressway of Xi’an City</em>, and the attribute
data are the <em>SUHI</em>(surface urban heat island effect) and its
influence factors.</p>
<pre><code><span><span class="co">## Error in knitr::include_graphics("../man/figures/spade_studyarea.png"): Cannot find the file(s): "../man/figures/spade_studyarea.png"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="spatial-pattern-of-suhi">Spatial pattern of SUHI<a class="anchor" aria-label="anchor" href="#spatial-pattern-of-suhi"></a>
</h3>
<div class="section level4">
<h4 id="global-spatial-autocorrelation-of-suhi">global spatial autocorrelation of SUHI<a class="anchor" aria-label="anchor" href="#global-spatial-autocorrelation-of-suhi"></a>
</h4>
<p>here I use <code>sfdep</code> o calculate the global <strong>Moran’s
I</strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_moranI</span> <span class="op">=</span> \<span class="op">(</span><span class="va">data</span>,<span class="va">col</span>,<span class="va">nb</span>,<span class="va">wt</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">I</span> <span class="op">=</span> <span class="fu">sfdep</span><span class="fu">::</span><span class="fu"><a href="https://sfdep.josiahparry.com/reference/global_moran.html" class="external-link">global_moran</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">data</span>,<span class="op">{</span><span class="op">{</span><span class="va">col</span><span class="op">}</span><span class="op">}</span><span class="op">)</span>,</span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">data</span>,<span class="op">{</span><span class="op">{</span><span class="va">nb</span><span class="op">}</span><span class="op">}</span><span class="op">)</span>,</span>
<span>                          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">data</span>,<span class="op">{</span><span class="op">{</span><span class="va">wt</span><span class="op">}</span><span class="op">}</span><span class="op">)</span>,</span>
<span>                          na_ok <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">$</span><span class="va">I</span></span>
<span>  <span class="va">PValue</span> <span class="op">=</span> <span class="fu">sfdep</span><span class="fu">::</span><span class="fu"><a href="https://sfdep.josiahparry.com/reference/global_moran_test.html" class="external-link">global_moran_test</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">data</span>,<span class="op">{</span><span class="op">{</span><span class="va">col</span><span class="op">}</span><span class="op">}</span><span class="op">)</span>,</span>
<span>                                    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">data</span>,<span class="op">{</span><span class="op">{</span><span class="va">nb</span><span class="op">}</span><span class="op">}</span><span class="op">)</span>,</span>
<span>                                    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">data</span>,<span class="op">{</span><span class="op">{</span><span class="va">wt</span><span class="op">}</span><span class="op">}</span><span class="op">)</span>,</span>
<span>                                    na.action <span class="op">=</span> <span class="va">na.omit</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span>
<span>  <span class="va">moranI</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">I</span>,<span class="va">PValue</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">moranI</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Moran'I Index"</span>,<span class="st">"P Value"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">moranI</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">usfi</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">if_any</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>,<span class="va">is.na</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>nb <span class="op">=</span> <span class="fu">sfdep</span><span class="fu">::</span><span class="fu"><a href="https://sfdep.josiahparry.com/reference/st_contiguity.html" class="external-link">st_contiguity</a></span><span class="op">(</span><span class="va">geom</span><span class="op">)</span>,</span>
<span>         wt <span class="op">=</span> <span class="fu">sfdep</span><span class="fu">::</span><span class="fu"><a href="https://sfdep.josiahparry.com/reference/st_weights.html" class="external-link">st_weights</a></span><span class="op">(</span><span class="va">nb</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SUHI</span>,<span class="va">nb</span>,<span class="va">wt</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">new_usfi</span></span>
<span></span>
<span><span class="va">new_usfi</span></span>
<span><span class="co">## Simple feature collection with 1037 features and 3 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 295713 ymin: 3784916 xmax: 324202.2 ymax: 3804669</span></span>
<span><span class="co">## Projected CRS: WGS 84 / UTM zone 49N</span></span>
<span><span class="co">## # A tibble: 1,037 × 4</span></span>
<span><span class="co">##     SUHI nb         wt                                                                     geom</span></span>
<span><span class="co">##    &lt;dbl&gt; &lt;nb&gt;       &lt;list&gt;                                                        &lt;POLYGON [m]&gt;</span></span>
<span><span class="co">##  1 1.76  &lt;int [12]&gt; &lt;dbl [12]&gt; ((297871.4 3787333, 297864.8 3787343, 297852.8 3787362, 297840.…</span></span>
<span><span class="co">##  2 0.519 &lt;int [2]&gt;  &lt;dbl [2]&gt;  ((297398.6 3788768, 297397.5 3788779, 297395.2 3788804, 297393.…</span></span>
<span><span class="co">##  3 3.04  &lt;int [9]&gt;  &lt;dbl [9]&gt;  ((297391.4 3789405, 297391 3789429, 297390.5 3789454, 297390.1 …</span></span>
<span><span class="co">##  4 3.22  &lt;int [4]&gt;  &lt;dbl [4]&gt;  ((297244.1 3790712, 297240.4 3790729, 297235 3790751, 297229.6 …</span></span>
<span><span class="co">##  5 3.47  &lt;int [6]&gt;  &lt;dbl [6]&gt;  ((296806.9 3791969, 296806.7 3791970, 296797.7 3791990, 296788.…</span></span>
<span><span class="co">##  6 4.71  &lt;int [6]&gt;  &lt;dbl [6]&gt;  ((296484.5 3792805, 296481.4 3792815, 296474.7 3792837, 296467.…</span></span>
<span><span class="co">##  7 1.24  &lt;int [2]&gt;  &lt;dbl [2]&gt;  ((296356.5 3793294, 296355.5 3793298, 296351.3 3793316, 296347.…</span></span>
<span><span class="co">##  8 4.30  &lt;int [8]&gt;  &lt;dbl [8]&gt;  ((296154.6 3794673, 296152.3 3794688, 296148.6 3794713, 296144.…</span></span>
<span><span class="co">##  9 3.76  &lt;int [5]&gt;  &lt;dbl [5]&gt;  ((296261.4 3798947, 296268.7 3798960, 296280.2 3798979, 296287.…</span></span>
<span><span class="co">## 10 4.23  &lt;int [5]&gt;  &lt;dbl [5]&gt;  ((296996.6 3800017, 297000.9 3800022, 297013.3 3800038, 297025.…</span></span>
<span><span class="co">## # ℹ 1,027 more rows</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123456789</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gmi</span> <span class="op">=</span> <span class="va">new_usfi</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">global_moranI</span><span class="op">(</span><span class="va">SUHI</span>,<span class="va">nb</span>,<span class="va">wt</span><span class="op">)</span></span>
<span><span class="va">gmi</span></span>
<span><span class="co">## Moran'I Index       P Value </span></span>
<span><span class="co">##  5.359564e-01 5.078059e-217</span></span></code></pre></div>
<p>The global Moran’s Index is 0.5359564 and the P value is 5.0780594 ×
10<sup>-217</sup>,which shows that SUHI in the main urban area of Xi’an
has significant positive spatial autocorrelation in the global
scale.</p>
</div>
<div class="section level4">
<h4 id="local-spatial-autocorrelation-of-suhi">local spatial autocorrelation of SUHI<a class="anchor" aria-label="anchor" href="#local-spatial-autocorrelation-of-suhi"></a>
</h4>
<p>We will use <code>tidyrgeoda</code> to run the <code>LISA</code>,
more details see <a href="https://spatlyu.github.io/tidyrgeoda/articles/Local-Indicators-of-Spatial-Association.html" class="external-link"><strong>here</strong></a></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tidyrgeoda</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_usfi</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>lisa <span class="op">=</span> <span class="fu">st_local_moran</span><span class="op">(</span><span class="va">.</span>,<span class="st">'SUHI'</span>,</span>
<span>                               wt <span class="op">=</span> <span class="fu">st_contiguity_weights</span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,</span>
<span>                               significance_cutoff <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">lisa</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">lisa</span><span class="op">)</span>,lwd <span class="op">=</span> <span class="fl">.1</span>,color <span class="op">=</span> <span class="st">'grey'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_lisa</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'SUHI-LISA'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">.3</span>, <span class="st">'cm'</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="reference/figures/SPADE-SUHI_LISA-1.png" alt="plot of chunk SUHI_LISA" width="75%"><p class="caption">
plot of chunk SUHI_LISA
</p>
</div>
<p>The global and local spatial autocorrelation shows that SUHI’s strong
spatial dependence.</p>
<p>Spatial dependence was neglected in native geodetector, which led to
the <strong>SPADE</strong> spatial association detector.</p>
</div>
</div>
<div class="section level3">
<h3 id="opgd-modeling">OPGD modeling<a class="anchor" aria-label="anchor" href="#opgd-modeling"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usfi_opgd</span> <span class="op">=</span> <span class="fu"><a href="../reference/opgd.html">opgd</a></span><span class="op">(</span><span class="va">SUHI</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">usfi</span><span class="op">)</span>, discnum <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">15</span>,</span>
<span>                 discvar <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">usfi</span><span class="op">)</span>,<span class="op">-</span><span class="va">SUHI</span><span class="op">)</span><span class="op">)</span>,cores <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<p><strong>You can access the detailed q statistics by
<code>usfi_opgd$factor</code></strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usfi_opgd</span><span class="op">$</span><span class="va">factor</span></span>
<span><span class="co">## # A tibble: 18 × 3</span></span>
<span><span class="co">##    variable `Q-statistic` `P-value`</span></span>
<span><span class="co">##    &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">##  1 DAR             0.439   4.88e-10</span></span>
<span><span class="co">##  2 NDVI            0.397   2.02e-10</span></span>
<span><span class="co">##  3 GAR             0.382   8.25e-10</span></span>
<span><span class="co">##  4 RFD             0.267   7.40e-10</span></span>
<span><span class="co">##  5 BD              0.265   3.25e-10</span></span>
<span><span class="co">##  6 BH              0.248   8.79e-11</span></span>
<span><span class="co">##  7 NDWI            0.208   6.59e-10</span></span>
<span><span class="co">##  8 FAR             0.198   1.35e-10</span></span>
<span><span class="co">##  9 SVF             0.131   4.97e-10</span></span>
<span><span class="co">## 10 RL              0.123   8.89e-10</span></span>
<span><span class="co">## 11 TER             0.116   6.77e- 8</span></span>
<span><span class="co">## 12 WAR             0.106   5.57e-10</span></span>
<span><span class="co">## 13 LSI             0.0767  3.21e- 6</span></span>
<span><span class="co">## 14 DTH             0.0763  7.67e- 6</span></span>
<span><span class="co">## 15 DTP             0.0748  7.95e-10</span></span>
<span><span class="co">## 16 DTW             0.0558  4.07e- 4</span></span>
<span><span class="co">## 17 DTR             0.0529  3.94e- 7</span></span>
<span><span class="co">## 18 LPI             0.0288  8.16e- 1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="spade-modeling">SPADE modeling<a class="anchor" aria-label="anchor" href="#spade-modeling"></a>
</h3>
<p><em>SPADE</em> explicitly considers the spatial variance by assigning
the weight of the influence based on spatial distribution and also
minimizes the influence of the number of levels on PD values by using
the multilevel discretization and considering information loss due to
discretization.</p>
<p>When response variable has a strong spatial dependence, maybe
<em>SPADE</em> is a best choice.</p>
<p>The biggest difference between SPADE and native GD and OPGD in actual
modeling is that SPADE requires a spatial weight matrix to calculate
spatial variance.</p>
<p>In <code>gdverse</code>, when you not provide a spatial weight
matrix, it will use <strong>1st order inverse distance weight</strong>,
which can be created by <code><a href="../reference/inverse_distance_weight.html">inverse_distance_weight()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coords</span> <span class="op">=</span> <span class="va">usfi</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wt1</span> <span class="op">=</span> <span class="fu"><a href="../reference/inverse_distance_weight.html">inverse_distance_weight</a></span><span class="op">(</span><span class="va">coords</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">coords</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>You can also use gravity weight by assigning <code>power</code>
parameter in <code><a href="../reference/inverse_distance_weight.html">inverse_distance_weight()</a></code> function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wt2</span> <span class="op">=</span> <span class="fu"><a href="../reference/inverse_distance_weight.html">inverse_distance_weight</a></span><span class="op">(</span><span class="va">coords</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">coords</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,power <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>You can also use spatial weight matrix from <code>sfdep</code>(which
invoke <code>spdep</code>) or <code>tidyrgeoda</code>(which invoke
`rgeoda``)</p>
<div class="section level4">
<h4 id="using-spatial-weight-matrix-from-sfdep">using spatial weight matrix from sfdep<a class="anchor" aria-label="anchor" href="#using-spatial-weight-matrix-from-sfdep"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wt3</span> <span class="op">=</span> <span class="va">usfi</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">if_any</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>,<span class="va">is.na</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>nb <span class="op">=</span> <span class="fu">sfdep</span><span class="fu">::</span><span class="fu"><a href="https://sfdep.josiahparry.com/reference/st_contiguity.html" class="external-link">st_contiguity</a></span><span class="op">(</span><span class="va">geom</span><span class="op">)</span>,</span>
<span>         wt <span class="op">=</span> <span class="fu">sfdep</span><span class="fu">::</span><span class="fu"><a href="https://sfdep.josiahparry.com/reference/st_weights.html" class="external-link">st_weights</a></span><span class="op">(</span><span class="va">nb</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/exposition.html" class="external-link">%$%</a></span></span>
<span>  <span class="fu">sfdep</span><span class="fu">::</span><span class="fu"><a href="https://sfdep.josiahparry.com/reference/wt_as_matrix.html" class="external-link">wt_as_matrix</a></span><span class="op">(</span><span class="va">nb</span>,<span class="va">wt</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="using-spatial-weight-matrix-from-tidyrgeoda">using spatial weight matrix from tidyrgeoda<a class="anchor" aria-label="anchor" href="#using-spatial-weight-matrix-from-tidyrgeoda"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wt4</span> <span class="op">=</span> <span class="fu">tidyrgeoda</span><span class="fu">::</span><span class="fu">st_contiguity_weights</span><span class="op">(</span><span class="va">usfi</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/coerce.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fl">1</span>,\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/transpose.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The <code>wt3</code> is identical <code>wt4</code></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">wt3</span>,<span class="va">wt4</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span></code></pre></div>
<p>In the following section we will execute <em>SPADE</em> model using
spatial weight matrix <code>wt3</code>.</p>
</div>
<div class="section level4">
<h4 id="run-spade">run SPADE<a class="anchor" aria-label="anchor" href="#run-spade"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usfi_spade</span> <span class="op">=</span> <span class="fu"><a href="../reference/spade.html">spade</a></span><span class="op">(</span><span class="va">SUHI</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">usfi</span><span class="op">)</span>, wt <span class="op">=</span> <span class="va">wt3</span>, discnum <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">15</span>,</span>
<span>                   discvar <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">usfi</span><span class="op">)</span>,<span class="op">-</span><span class="va">SUHI</span><span class="op">)</span><span class="op">)</span>,cores <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">usfi_spade</span></span>
<span><span class="co">## Spatial Stratified Heterogeneity Test </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">##           Factor detector</span></span></code></pre></div>
<table style="width:49%;" class="table">
<colgroup>
<col width="15%">
<col width="19%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="center">variable</th>
<th align="center">Q-statistic</th>
<th align="center">P-value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">DAR</td>
<td align="center">0.5029</td>
<td align="center">0.01</td>
</tr>
<tr class="even">
<td align="center">NDVI</td>
<td align="center">0.469</td>
<td align="center">0.01</td>
</tr>
<tr class="odd">
<td align="center">NDWI</td>
<td align="center">0.4371</td>
<td align="center">0.01</td>
</tr>
<tr class="even">
<td align="center">GAR</td>
<td align="center">0.4199</td>
<td align="center">0.01</td>
</tr>
<tr class="odd">
<td align="center">RFD</td>
<td align="center">0.3943</td>
<td align="center">0.01</td>
</tr>
<tr class="even">
<td align="center">TER</td>
<td align="center">0.3909</td>
<td align="center">0.01</td>
</tr>
<tr class="odd">
<td align="center">BD</td>
<td align="center">0.3625</td>
<td align="center">0.01</td>
</tr>
<tr class="even">
<td align="center">BH</td>
<td align="center">0.3207</td>
<td align="center">0.01</td>
</tr>
<tr class="odd">
<td align="center">FAR</td>
<td align="center">0.2161</td>
<td align="center">0.01</td>
</tr>
<tr class="even">
<td align="center">DTR</td>
<td align="center">0.2002</td>
<td align="center">0.01</td>
</tr>
<tr class="odd">
<td align="center">LSI</td>
<td align="center">0.1685</td>
<td align="center">0.01</td>
</tr>
<tr class="even">
<td align="center">DTP</td>
<td align="center">0.1538</td>
<td align="center">0.01</td>
</tr>
<tr class="odd">
<td align="center">RL</td>
<td align="center">0.1436</td>
<td align="center">0.01</td>
</tr>
<tr class="even">
<td align="center">LPI</td>
<td align="center">0.1424</td>
<td align="center">0.01</td>
</tr>
<tr class="odd">
<td align="center">DTW</td>
<td align="center">0.1365</td>
<td align="center">0.01</td>
</tr>
<tr class="even">
<td align="center">SVF</td>
<td align="center">0.1268</td>
<td align="center">0.01</td>
</tr>
<tr class="odd">
<td align="center">DTH</td>
<td align="center">0.08443</td>
<td align="center">0.01</td>
</tr>
<tr class="even">
<td align="center">WAR</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
</tbody>
</table>
<p><strong>You can also access the detailed q statistics by
<code>usfi_spade$factor</code></strong></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usfi_spade</span><span class="op">$</span><span class="va">factor</span></span>
<span><span class="co">## # A tibble: 18 × 3</span></span>
<span><span class="co">##    variable `Q-statistic` `P-value`</span></span>
<span><span class="co">##    &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">##  1 DAR             0.503       0.01</span></span>
<span><span class="co">##  2 NDVI            0.469       0.01</span></span>
<span><span class="co">##  3 NDWI            0.437       0.01</span></span>
<span><span class="co">##  4 GAR             0.420       0.01</span></span>
<span><span class="co">##  5 RFD             0.394       0.01</span></span>
<span><span class="co">##  6 TER             0.391       0.01</span></span>
<span><span class="co">##  7 BD              0.362       0.01</span></span>
<span><span class="co">##  8 BH              0.321       0.01</span></span>
<span><span class="co">##  9 FAR             0.216       0.01</span></span>
<span><span class="co">## 10 DTR             0.200       0.01</span></span>
<span><span class="co">## 11 LSI             0.169       0.01</span></span>
<span><span class="co">## 12 DTP             0.154       0.01</span></span>
<span><span class="co">## 13 RL              0.144       0.01</span></span>
<span><span class="co">## 14 LPI             0.142       0.01</span></span>
<span><span class="co">## 15 DTW             0.136       0.01</span></span>
<span><span class="co">## 16 SVF             0.127       0.01</span></span>
<span><span class="co">## 17 DTH             0.0844      0.01</span></span>
<span><span class="co">## 18 WAR           NaN          NA</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://spatlyu.github.io/" class="external-link">Wenbo Lv</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
